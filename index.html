<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Softball Lineup Editor</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; text-align: center; margin: 0; padding: 0; }
    h1 { background: #2c3e50; color: white; margin: 0; padding: 20px; }
    .field {
      position: relative;
      width: 500px;
      height: 500px;
      background: radial-gradient(circle at center, #a5d6a7 60%, #6abf69 100%);
      margin: 30px auto;
      border-radius: 50%;
      box-shadow: inset 0 0 10px #333;
    }
    .base {
      width: 50px;
      height: 50px;
      background: #fff;
      position: absolute;
      transform: rotate(45deg);
    }
    .base.home { bottom: 30px; left: 50%; transform: translateX(-50%) rotate(45deg); }
    .base.first { right: 70px; bottom: 150px; }
    .base.second { top: 50%; right: 210px; transform: translateY(-50%) rotate(45deg); }
    .base.third { left: 70px; bottom: 150px; }
    .player {
      position: absolute;
      transform: translate(-50%, -50%);
      background: #1976d2;
      color: white;
      padding: 8px 12px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
    }
    input, button { margin: 5px; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
    button { cursor: pointer; background: #2c3e50; color: white; }
  </style>
</head>
<body>
  <h1>Softball Lineup Editor</h1>

  <div id="login">
    <p>Enter password to edit lineup:</p>
    <input type="password" id="pwInput" placeholder="Password">
    <button onclick="checkPassword()">Login</button>
  </div>

  <div id="editor" style="display:none;">
    <div class="field" id="field"></div>
    <div>
      <input id="name" placeholder="Player Name">
      <input id="position" placeholder="Position">
      <button onclick="addPlayer()">Add Player</button>
    </div>
  </div>

  <script>
    const apiURL = "https://script.google.com/macros/s/AKfycbx8u8pUTWaeZn0HHfocuTE-9wMFOFCmCyXLklEdiOuMVLIwGfDa50SyM8Qr8UYF6NxL/exec";
    const password = "softball123"; // must match Apps Script

    let players = [];

    function checkPassword() {
      const pw = document.getElementById("pwInput").value;
      if (pw === password) {
        document.getElementById("login").style.display = "none";
        document.getElementById("editor").style.display = "block";
        loadPlayers();
      } else {
        alert("Incorrect password");
      }
    }

    async function loadPlayers() {
      const res = await fetch(apiURL);
      players = await res.json();
      renderField();
    }

    function renderField() {
      const field = document.getElementById("field");
      field.innerHTML = `
        <div class="base home"></div>
        <div class="base first"></div>
        <div class="base second"></div>
        <div class="base third"></div>
      `;
      players.forEach(p => {
        const div = document.createElement("div");
        div.className = "player";
        div.textContent = p.name;
        div.style.left = (p.x || 250) + "px";
        div.style.top = (p.y || 250) + "px";
        div.draggable = true;
        div.ondragend = e => updatePosition(p.id, e.offsetX, e.offsetY);
        field.appendChild(div);
      });
    }

    async function addPlayer() {
      const body = {
        action: "add",
        password,
        name: document.getElementById("name").value,
        position: document.getElementById("position").value,
        x: 250,
        y: 250
      };
      await fetch(apiURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      loadPlayers();
    }

    async function updatePosition(id, x, y) {
      const player = players.find(p => p.id === id);
      if (!player) return;
      const body = {
        action: "update",
        password,
        id,
        name: player.name,
        position: player.position,
        x, y
      };
      await fetch(apiURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      loadPlayers();
    }
  </script>
</body>
</html>
